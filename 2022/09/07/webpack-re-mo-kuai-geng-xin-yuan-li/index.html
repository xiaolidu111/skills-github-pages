<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
		<meta name="keywords" content="webpack热更新原理, xiaolidu-blog" />
		<meta
			name="description"
			content="webpack热更新原理

场景
如果不开启热模块更新,那么刷新页面的话,会重新渲染整个页面如果开启热模块更新,那么刷新页面的话,原来的dom还是存在的,样式直接作用在这个页面中也就是说刷新的话,不会丢失掉之前的已经渲染好的dom元素无需完"
		/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, user-scalable=no"
		/>
		<meta name="renderer" content="webkit|ie-stand|ie-comp" />
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta
			name="apple-mobile-web-app-status-bar-style"
			content="black-translucent"
		/>
		<meta name="referrer" content="no-referrer-when-downgrade" />
		<!-- Global site tag (gtag.js) - Google Analytics -->

		<title>webpack热更新原理 | xiaolidu-blog</title>
		<link rel="icon" type="image/png" href="/favicon.png" />

		<style>
			body {
				background-image: url(https://cdn.jsdelivr.net/gh/Tokisaki-Galaxy/res/site/medias/background.jpg);
				background-repeat: no-repeat;
				background-size: 100% 100%;
				background-attachment: fixed;
			}
		</style>

		<!-- bg-cover style     -->

		<link
			rel="stylesheet"
			type="text/css"
			href="/skills-github-pages/libs/awesome/css/all.min.css"
		/>
		<link
			rel="stylesheet"
			type="text/css"
			href="/skills-github-pages/libs/materialize/materialize.min.css"
		/>
		<link
			rel="stylesheet"
			type="text/css"
			href="/skills-github-pages/libs/aos/aos.css"
		/>
		<link
			rel="stylesheet"
			type="text/css"
			href="/skills-github-pages/libs/animate/animate.min.css"
		/>
		<link
			rel="stylesheet"
			type="text/css"
			href="/skills-github-pages/libs/lightGallery/css/lightgallery.min.css"
		/>
		<link rel="stylesheet" type="text/css" href="/css/matery.css" />
		<link rel="stylesheet" type="text/css" href="/css/my.css" />
		<link
			rel="stylesheet"
			type="text/css"
			href="/css/dark.css"
			media="none"
			onload="if(media!='all')media='all'"
		/>

		<link
			rel="stylesheet"
			href="/skills-github-pages/libs/tocbot/tocbot.css"
		/>
		<link rel="stylesheet" href="/css/post.css" />

		<link rel="stylesheet" type="text/css" href="/css/reward.css" />

		<script src="/skills-github-pages/libs/jquery/jquery-3.6.0.min.js"></script>

		<meta name="generator" content="Hexo 6.3.0" />
		<style>
			.github-emoji {
				position: relative;
				display: inline-block;
				width: 1.2em;
				min-height: 1.2em;
				overflow: hidden;
				vertical-align: top;
				color: transparent;
			}
			.github-emoji > span {
				position: relative;
				z-index: 10;
			}
			.github-emoji img,
			.github-emoji .fancybox {
				margin: 0 !important;
				padding: 0 !important;
				border: none !important;
				outline: none !important;
				text-decoration: none !important;
				user-select: none !important;
				cursor: auto !important;
			}
			.github-emoji img {
				height: 1.2em !important;
				width: 1.2em !important;
				position: absolute !important;
				left: 50% !important;
				top: 50% !important;
				transform: translate(-50%, -50%) !important;
				user-select: none !important;
				cursor: auto !important;
			}
			.github-emoji-fallback {
				color: inherit;
			}
			.github-emoji-fallback img {
				opacity: 0 !important;
			}
		</style>
	</head>

	<body>
		<header class="navbar-fixed">
			<nav id="headNav" class="bg-color nav-transparent">
				<div id="navContainer" class="nav-wrapper container">
					<div class="brand-logo">
						<a href="/" class="waves-effect waves-light">
							<img
								src="/medias/logo.png"
								class="logo-img"
								alt="LOGO"
							/>

							<span class="logo-span">xiaolidu-blog</span>
						</a>
					</div>

					<a
						href="#"
						data-target="mobile-nav"
						class="sidenav-trigger button-collapse"
						><i class="fas fa-bars"></i
					></a>
					<ul class="right nav-menu">
						<li class="hide-on-med-and-down nav-item">
							<a href="/" class="waves-effect waves-light">
								<i class="fas fa-home" style="zoom: 0.6"></i>

								<span>首页</span>
							</a>
						</li>

						<li class="hide-on-med-and-down nav-item">
							<a href="/tags" class="waves-effect waves-light">
								<i class="fas fa-tags" style="zoom: 0.6"></i>

								<span>标签</span>
							</a>
						</li>

						<li class="hide-on-med-and-down nav-item">
							<a
								href="/categories"
								class="waves-effect waves-light"
							>
								<i
									class="fas fa-bookmark"
									style="zoom: 0.6"
								></i>

								<span>分类</span>
							</a>
						</li>

						<li class="hide-on-med-and-down nav-item">
							<a
								href="/archives"
								class="waves-effect waves-light"
							>
								<i class="fas fa-archive" style="zoom: 0.6"></i>

								<span>归档</span>
							</a>
						</li>

						<li class="hide-on-med-and-down nav-item">
							<a href="/about" class="waves-effect waves-light">
								<i
									class="fas fa-user-circle"
									style="zoom: 0.6"
								></i>

								<span>关于</span>
							</a>
						</li>

						<li class="hide-on-med-and-down nav-item">
							<a href="/contact" class="waves-effect waves-light">
								<i
									class="fas fa-comments"
									style="zoom: 0.6"
								></i>

								<span>留言板</span>
							</a>
						</li>

						<li class="hide-on-med-and-down nav-item">
							<a href="/friends" class="waves-effect waves-light">
								<i
									class="fas fa-address-book"
									style="zoom: 0.6"
								></i>

								<span>友情链接</span>
							</a>
						</li>

						<li>
							<a
								href="#searchModal"
								class="modal-trigger waves-effect waves-light"
							>
								<i
									id="searchIcon"
									class="fas fa-search"
									title="搜索"
									style="zoom: 0.85"
								></i>
							</a>
						</li>
						<li>
							<a
								href="javascript:;"
								class="waves-effect waves-light"
								onclick="switchNightMode()"
								title="深色/浅色模式"
							>
								<i
									id="sum-moon-icon"
									class="fas fa-sun"
									style="zoom: 0.85"
								></i>
							</a>
						</li>
					</ul>

					<div id="mobile-nav" class="side-nav sidenav">
						<div class="mobile-head bg-color">
							<img
								src="/medias/logo.png"
								class="logo-img circle responsive-img"
							/>

							<div class="logo-name">xiaolidu-blog</div>
							<div class="logo-desc">
								Never really desperate, only the lost of the
								soul.
							</div>
						</div>

						<ul class="menu-list mobile-menu-list">
							<li class="m-nav-item">
								<a href="/" class="waves-effect waves-light">
									<i class="fa-fw fas fa-home"></i>

									首页
								</a>
							</li>

							<li class="m-nav-item">
								<a
									href="/tags"
									class="waves-effect waves-light"
								>
									<i class="fa-fw fas fa-tags"></i>

									标签
								</a>
							</li>

							<li class="m-nav-item">
								<a
									href="/categories"
									class="waves-effect waves-light"
								>
									<i class="fa-fw fas fa-bookmark"></i>

									分类
								</a>
							</li>

							<li class="m-nav-item">
								<a
									href="/archives"
									class="waves-effect waves-light"
								>
									<i class="fa-fw fas fa-archive"></i>

									归档
								</a>
							</li>

							<li class="m-nav-item">
								<a
									href="/about"
									class="waves-effect waves-light"
								>
									<i class="fa-fw fas fa-user-circle"></i>

									关于
								</a>
							</li>

							<li class="m-nav-item">
								<a
									href="/contact"
									class="waves-effect waves-light"
								>
									<i class="fa-fw fas fa-comments"></i>

									留言板
								</a>
							</li>

							<li class="m-nav-item">
								<a
									href="/friends"
									class="waves-effect waves-light"
								>
									<i class="fa-fw fas fa-address-book"></i>

									友情链接
								</a>
							</li>

							<li><div class="divider"></div></li>
							<li>
								<a
									href="https://github.com/blinkfox/hexo-theme-matery"
									class="waves-effect waves-light"
									target="_blank"
								>
									<i class="fab fa-github-square fa-fw"></i
									>Fork Me
								</a>
							</li>
						</ul>
					</div>
				</div>

				<style>
					.nav-transparent .github-corner {
						display: none !important;
					}

					.github-corner {
						position: absolute;
						z-index: 10;
						top: 0;
						right: 0;
						border: 0;
						transform: scale(1.1);
					}

					.github-corner svg {
						color: #0f9d58;
						fill: #fff;
						height: 64px;
						width: 64px;
					}

					.github-corner:hover .octo-arm {
						animation: a 0.56s ease-in-out;
					}

					.github-corner .octo-arm {
						animation: none;
					}

					@keyframes a {
						0%,
						to {
							transform: rotate(0);
						}
						20%,
						60% {
							transform: rotate(-25deg);
						}
						40%,
						80% {
							transform: rotate(10deg);
						}
					}
				</style>

				<a
					href="https://github.com/blinkfox/hexo-theme-matery"
					class="github-corner tooltipped hide-on-med-and-down"
					target="_blank"
					data-tooltip="Fork Me"
					data-position="left"
					data-delay="50"
				>
					<svg viewBox="0 0 250 250" aria-hidden="true">
						<path
							d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"
						></path>
						<path
							d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
							fill="currentColor"
							style="transform-origin: 130px 106px"
							class="octo-arm"
						></path>
						<path
							d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
							fill="currentColor"
							class="octo-body"
						></path>
					</svg>
				</a>
			</nav>
		</header>

		<script src="/skills-github-pages/libs/cryptojs/crypto-js.min.js"></script>
		<script>
			(function () {
				let pwd = '';
				if (pwd && pwd.length > 0) {
					if (
						pwd !==
						CryptoJS.SHA256(
							prompt('请输入访问本文章的密码')
						).toString(CryptoJS.enc.Hex)
					) {
						alert('密码错误，将返回主页！');
						location.href = '/';
					}
				}
			})();
		</script>

		<div
			class="bg-cover pd-header post-cover"
			style="background-image: url('/medias/featureimages/21.jpg')"
		>
			<div class="container" style="right: 0px; left: 0px">
				<div class="row">
					<div class="col s12 m12 l12">
						<div class="brand">
							<h1 class="description center-align post-title">
								webpack热更新原理
							</h1>
						</div>
					</div>
				</div>
			</div>
		</div>

		<main class="post-container content">
			<div class="row">
				<div id="main-content" class="col s12 m12 l9">
					<!-- 文章内容详情 -->
					<div id="artDetail">
						<div class="card">
							<div class="card-content article-info">
								<div class="row tag-cate">
									<div class="col s7">
										<div class="article-tag">
											<a href="/tags/%E9%9D%A2%E8%AF%95/">
												<span class="chip bg-color"
													>面试</span
												>
											</a>
										</div>
									</div>
									<div class="col s5 right-align">
										<div class="post-cate">
											<i
												class="fas fa-bookmark fa-fw icon-category"
											></i>

											<a
												href="/categories/%E9%9D%A2%E8%AF%95/"
												class="post-category"
											>
												面试
											</a>
										</div>
									</div>
								</div>

								<div class="post-info">
									<div class="post-date info-break-policy">
										<i
											class="far fa-calendar-minus fa-fw"
										></i
										>发布日期:&nbsp;&nbsp; 2022-09-07
									</div>

									<div class="info-break-policy">
										<i class="far fa-file-word fa-fw"></i
										>文章字数:&nbsp;&nbsp; 3.2k
									</div>
								</div>
							</div>
							<hr class="clearfix" />

							<!-- 是否加载使用自带的 prismjs. -->
							<link
								rel="stylesheet"
								href="/skills-github-pages/libs/prism/prism.min.css"
							/>

							<div class="card-content article-card-content">
								<div id="articleContent">
									<p>webpack热更新原理</p>
									<span id="more"></span>
									<h4 id="场景">
										<a
											href="#场景"
											class="headerlink"
											title="场景"
										></a
										>场景
									</h4>
									<blockquote>
										<p>
											如果不开启热模块更新,那么刷新页面的话,会重新渲染整个页面<br />如果开启热模块更新,那么刷新页面的话,原来的dom还是存在的,样式直接作用在这个页面中<br />也就是说刷新的话,不会丢失掉之前的已经渲染好的dom元素<br />无需完全刷新整个页面的同时，更新模块。==HMR==的好处，在日常开发工作中体会颇深：<strong>节省宝贵的开发时间、提升开发体验</strong>。
										</p>
									</blockquote>
									<h4 id="什么是HMR">
										<a
											href="#什么是HMR"
											class="headerlink"
											title="什么是HMR"
										></a
										>什么是HMR
									</h4>
									<blockquote>
										<p>
											当我们对代码修改并保存后,webpack将会对代码进项重新打包,并将新的模块发送到浏览器端,浏览器用新的模块替换掉旧的模块,以实现不刷新浏览器的前提更新页面
										</p>
									</blockquote>
									<h4 id="如何使用">
										<a
											href="#如何使用"
											class="headerlink"
											title="如何使用"
										></a
										>如何使用
									</h4>
									<p>
										<img
											src="/images/image_1.dfd95cb8.png"
										/>
									</p>
									<p>
										导出一个对象,其中是这个的配置,包括模式,入口,出口,开启devserver,需要用到两个插件
										一个是<code>htmlWebpackPlugin</code>还有一个是这个<code>webpack.HotModuleReplacementPlugin()</code>这两个插件
									</p>
									<p>
										<img
											src="/images/image_2.4a9e9e49.png"
										/>
									</p>
									<p>在title.js中导出一个字符串</p>
									<p>
										<img
											src="/images/image_3.a0629296.png"
										/>
									</p>
									<p>
										在<code>index.js</code>中创建一个<code>input</code>标签,一个<code>div</code>标签,然后在拿到title.js中导出的模块,将其渲染在div中
									</p>
									<p>
										判断这个module中是不是有hot属性,可以通过这个accept方法接受这个模块,再次执行这个render函数进行渲染
									</p>
									<p>
										这样后续直接更改源代码,那么页面中的代码就直接更新,原来的<code>input</code>中输入的内容还是不会丢失,这样的体验就比较好
									</p>
									<h4 id="基础知识">
										<a
											href="#基础知识"
											class="headerlink"
											title="基础知识"
										></a
										>基础知识
									</h4>
									<h5 id="module和chunk">
										<a
											href="#module和chunk"
											class="headerlink"
											title="module和chunk"
										></a
										>module和chunk
									</h5>
									<ol>
										<li>在webpack中有各种各样的模块</li>
										<li>一般一个入口会依赖多个模块</li>
										<li>
											一个入口一般会对应一个chunk,这个chunk里包含这个入口依赖的所有的模块
										</li>
									</ol>
									<h5 id="HotModuleReplacementPlugin">
										<a
											href="#HotModuleReplacementPlugin"
											class="headerlink"
											title="HotModuleReplacementPlugin"
										></a
										>HotModuleReplacementPlugin
									</h5>
									<ol>
										<li>
											<p>
												会生成两个补丁<br />
												a.
												上次编译生成的hash.hot-update.json,说明从上次编译到现在哪些代码块发生改变<br />
												b.
												chunk名字,上一次编译生成的hash.hot-update.js,存放这个此代码块最新的模块定义,里面会调用webpackhotupdate方法
											</p>
										</li>
										<li>
											<p>
												首先会开启一个websocket,双向通信的一个服务
											</p>
										</li>
										<li><p>localhost请求的文件</p></li>
										<li>
											<p>
												当修改titlejs里面的内容,页面会多请求两个文件<br />
												a. hash.hot-update.json
												是一个对象,第一个是hash值是新的hash值,第二个是改变的文件<br />
												b.
												然后向服务器请求一个mian.hash.hot-update.js的文件,这个是一个脚本会执行,调用<code>webpackHotUpdat</code>方法,第一个是main代码块的名字,客户端会把新的模块定义更新到浏览器里面
											</p>
										</li>
										<li>
											<p>
												向代码块中注入HMR
												runtime代码,热更新的主要逻辑,比如拉取代码,执行代码,执行accept回调,都是它注入到chunk中的
											</p>
										</li>
										<li>
											<p>
												<code>hotCreateRequire</code
												>会帮我们给模块module的parents和children赋值
											</p>
										</li>
									</ol>
									<h4 id="刷新的种类">
										<a
											href="#刷新的种类"
											class="headerlink"
											title="刷新的种类"
										></a
										>刷新的种类
									</h4>
									<blockquote>
										<p>刷新一般可分为两种</p>
										<ul>
											<li>
												一种是页面刷新不保留页面的状态,就是简单粗暴,直接<code
													>window.loaction.reload()</code
												>
											</li>
											<li>
												另一种是基于<code>webpack-dev-server</code>的模块热替换,只需要局部刷新页面上发生变化的模块,同时可以保留当前的页面的状态,比如复选框的选中状态,输入框的输入等
											</li>
										</ul>
									</blockquote>
									<blockquote>
										<p>
											<code>HMR</code
											>作为一个<code>webpack</code>的内置功能,可以通过<code>HotModuleReplacementPlugin</code>或者是<code>--hot</code>开启,
										</p>
									</blockquote>
									<h4 id="webpack的编译构件过程">
										<a
											href="#webpack的编译构件过程"
											class="headerlink"
											title="webpack的编译构件过程"
										></a
										>webpack的编译构件过程
									</h4>
									<blockquote>
										<p>
											项目启动后,进行打包,会输出一个hash值,比如<code
												>a93fd735d02d98633356</code
											><br /><img
												src="/images/image_4.4e4d6884.png"
											/>
										</p>
										<p>
											然后每次修改代码,都会重新编译,可以在控制台看到新的hash值
										</p>
										<ul>
											<li>
												新的Hash值：<code
													>a61bdd6e82294ed06fa3</code
												>
											</li>
											<li>
												新的json文件：&nbsp;<code
													>a93fd735d02d98633356.hot-update.json</code
												>
											</li>
											<li>
												新的js文件：<code
													>index.a93fd735d02d98633356.hot-update.js</code
												>
											</li>
										</ul>
									</blockquote>
									<blockquote>
										<p>
											<img
												src="/images/image_5.4d9eec97.png"
											/>
										</p>
										<p>
											<code>hash</code
											>其实代表着每一次编译的标识,根据生成的文件名可以知道,上次输出的<code>hash</code>会作为这次的文件标识<br />每次修改代码,会触发重新编译,浏览器会发送两次请求,就是json和js文件<br /><img
												src="/images/image_6.f9428893.png"
											/><br />json中h代表本次生成的新的hash值,用于下次请求的文件名前缀,c标识热更新对应的文件是index模块<br /><img
												src="/images/image_7.fbbee0ae.png"
											/><br />js文件是本次修改的代码,重新编译打包之后的文件chunk
										</p>
										<h5 id="疑问">
											<a
												href="#疑问"
												class="headerlink"
												title="疑问"
											></a
											>疑问
										</h5>
										<p>
											浏览器如何知道本地代码重新编译并迅速请求了新生成的文件,是谁告诉了浏览器,浏览器获得这些文件有事如何热更新成功的
										</p>
									</blockquote>
									<h4 id="热更新实现原理">
										<a
											href="#热更新实现原理"
											class="headerlink"
											title="热更新实现原理"
										></a
										>热更新实现原理
									</h4>
									<h5 id="webpack-dev-server启动本地服务">
										<a
											href="#webpack-dev-server启动本地服务"
											class="headerlink"
											title="webpack-dev-server启动本地服务"
										></a
										>webpack-dev-server启动本地服务
									</h5>
									<p>
										首先是根据package.json中的bin命令,找到入口文件
									</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token comment">// node_modules/webpack-dev-server/bin/webpack-dev-server.js</span>

<span class="token comment">// 生成webpack编译主引擎 compiler</span>
<span class="token keyword">let</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 启动本地服务</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Server</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> options<span class="token punctuation">,</span> log<span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>port<span class="token punctuation">,</span> options<span class="token punctuation">.</span>host<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">throw</span> err<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token comment">// node_modules/webpack-dev-server/lib/Server.js</span>
<span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setupApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">setupApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 依赖了express</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>listeningApp <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">listen</span><span class="token punctuation">(</span><span class="token parameter">port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listeningApp<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 启动express服务后，启动websocket服务</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createSocketServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>                                   
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<p>这一部分主要做了三件事</p>
									<ul>
										<li>
											启动<code>webpack</code>生成<code>compiler</code>实例.<code>compiler</code>上有监听本地文件变化的方法
										</li>
										<li>
											使用<code>express</code>启动本地<code>server</code>,让浏览器请求本地的静态资源
										</li>
										<li>
											本地<code>server</code>启动后,再去启动<code>websocket</code>服务.通过这个<code>websocket</code>建立本地和服务器的双向通信.这样本地文件变化,就可以通知浏览器热更新代码
										</li>
									</ul>
									<h5 id="修改webpack-config-js的entry配置">
										<a
											href="#修改webpack-config-js的entry配置"
											class="headerlink"
											title="修改webpack.config.js的entry配置"
										></a
										>修改webpack.config.js的entry配置
									</h5>
									<p>
										启动本地服务前,调用了<code>updateCompiler(this.compiler)</code>这个方法,这个的作用一个是获取<code>websocket</code>客户端的代码路径,另一个是根据配置获取<code>webpack</code>热更新的代码路径
									</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token comment">// 获取websocket客户端代码</span>
<span class="token keyword">const</span> clientEntry <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
    <span class="token string">'../../client/'</span>
<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>domain<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sockHost<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sockPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sockPort<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token comment">// 根据配置获取热更新代码</span>
<span class="token keyword">let</span> hotEntry<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>hotOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    hotEntry <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'webpack/hot/only-dev-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    hotEntry <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'webpack/hot/dev-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<p>
										然后修改<code>webpack</code>的入口配置
									</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token comment">// 修改后的entry入口</span>
<span class="token punctuation">{</span> <span class="token literal-property property">entry</span><span class="token operator">:</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">index</span><span class="token operator">:</span> 
        <span class="token punctuation">[</span>
            <span class="token comment">// 上面获取的clientEntry</span>
            <span class="token string">'xxx/node_modules/webpack-dev-server/client/index.js?http://localhost:8080'</span><span class="token punctuation">,</span>
            <span class="token comment">// 上面获取的hotEntry</span>
            <span class="token string">'xxx/node_modules/webpack/hot/dev-server.js'</span><span class="token punctuation">,</span>
            <span class="token comment">// 开发配置的入口</span>
            <span class="token string">'./src/index.js'</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>      <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<p>
										增加两个文件,意味着会一起打包到<code>bundle</code>文件中,也就是线上运行时
									</p>
									<h6
										id="webpack-dev-server-x2F-client-x2F-index-js"
									>
										<a
											href="#webpack-dev-server-x2F-client-x2F-index-js"
											class="headerlink"
											title="webpack-dev-server/client/index.js"
										></a
										>webpack-dev-server/client/index.js
									</h6>
									<p>
										这个文件主要是用于<code>websocket</code>,服务端就是本地dev-server,客户端就是浏览器,在第一步的时候启动的是本地服务端的<code
											>websocket</code
										>
									</p>
									<h6 id="webpack-x2F-hot-x2F-dev-server-js">
										<a
											href="#webpack-x2F-hot-x2F-dev-server-js"
											class="headerlink"
											title="webpack/hot/dev-server.js"
										></a
										>webpack/hot/dev-server.js
									</h6>
									<p>
										主要是用来检查更新逻辑的,后面第五步会讲
									</p>
									<h5 id="监听webpack编译结束">
										<a
											href="#监听webpack编译结束"
											class="headerlink"
											title="监听webpack编译结束"
										></a
										>监听webpack编译结束
									</h5>
									<p>
										修改入口配置之后,调用<code>setupHooks</code>方法,这个方法是用来监听注册事件的,监听每次webpack编译完成
									</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token comment">// node_modules/webpack-dev-server/lib/Server.js</span>
<span class="token comment">// 绑定监听事件</span>
<span class="token function">setupHooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>done<span class="token punctuation">}</span> <span class="token operator">=</span> compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">;</span>
    <span class="token comment">// 监听webpack的done钩子，tapable提供的监听方法</span>
    done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-server'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_sendStats</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sockets<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStats</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_stats <span class="token operator">=</span> stats<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<p>
										每次监听到webpack包结束,都会调用<code>_sendStats</code>方法通过<code>websocket</code>给客户端发送通知,这样浏览器就可以拿到最新的hash值了
									</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token comment">// 通过websoket给客户端发消息</span>
<span class="token function">_sendStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sockWrite</span><span class="token punctuation">(</span>sockets<span class="token punctuation">,</span> <span class="token string">'hash'</span><span class="token punctuation">,</span> stats<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sockWrite</span><span class="token punctuation">(</span>sockets<span class="token punctuation">,</span> <span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<h5 id="webpack监听文件变化">
										<a
											href="#webpack监听文件变化"
											class="headerlink"
											title="webpack监听文件变化"
										></a
										>webpack监听文件变化
									</h5>
									<p>
										这个主要是使用<code>setupDevMiddleware</code>完成的
									</p>
									<p>
										这个方法主要是执行了<code>webpack-dev-middleware</code>库.所有的文件相关的操作都抽离到<code>webpack-dev-middleware</code>库中了,主要是负责文件的<code>编译``输出</code>和<code>监听</code>,<code>webpack-dev-server</code>只是负责启动服务和前置准备工作.只是职责划分更清晰了
									</p>
									<p>
										<code>webpack-dev-middleware</code
										>源码分析
									</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token comment">// node_modules/webpack-dev-middleware/index.js</span>
compiler<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>watchOptions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*错误处理*/</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 通过“memory-fs”库将打包后的文件写入内存</span>
<span class="token function">setFs</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<h6 id="调用了compilet-watch方法">
										<a
											href="#调用了compilet-watch方法"
											class="headerlink"
											title="调用了compilet.watch方法"
										></a
										>调用了<code>compilet.watch</code>方法
									</h6>
									<blockquote>
										<p>
											通过这个方法监听本地文件是否发生变化
										</p>
									</blockquote>
									<h6 id="执行setFs方法">
										<a
											href="#执行setFs方法"
											class="headerlink"
											title="执行setFs方法"
										></a
										>执行<code>setFs</code>方法
									</h6>
									<blockquote>
										<p>
											这个方法主要是将编译后的代码打包到内存,这就是为什么在开发的时候,dist目录没有代码,因为都在内存中,这是因为保存在内存,比在储存里面访问要快
										</p>
									</blockquote>
									<h5 id="浏览器接收到热更新的通知">
										<a
											href="#浏览器接收到热更新的通知"
											class="headerlink"
											title="浏览器接收到热更新的通知"
										></a
										>浏览器接收到热更新的通知
									</h5>
									<p>
										现在已经可以监听到文件的变化,当文件变化,就会触发重新编译,同时监听了编译结束的事件,当事件结束,就会调用<code>_sendStates</code>通过<code>websocket</code>给浏览器发送一个通知,检查是否需要热更新
									</p>
									<p>
										浏览器通过增加的入口文件来接受<code>websocket</code>传递过来的代码
									</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token string">'xxx/node_modules/webpack-dev-server/client/index.js?http://localhost:8080'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

									<p>
										这个文件会包打包到<code>bundle.js</code>中,代码简化如下
									</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token comment">// webpack-dev-server/client/index.js</span>
<span class="token keyword">var</span> socket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./socket'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> onSocketMessage <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">hash</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token parameter">_hash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 更新currentHash值</span>
        status<span class="token punctuation">.</span>currentHash <span class="token operator">=</span> _hash<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">ok</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'Ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 进行更新检查等操作</span>
        <span class="token function">reloadApp</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 连接服务地址socketUrl，?http://localhost:8080，本地服务地址</span>
<span class="token function">socket</span><span class="token punctuation">(</span>socketUrl<span class="token punctuation">,</span> onSocketMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reloadApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'[WDS] App hot update...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// hotEmitter其实就是EventEmitter的实例</span>
        <span class="token keyword">var</span> hotEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack/hot/emitter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hotEmitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'webpackHotUpdate'</span><span class="token punctuation">,</span> currentHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<p>
										<code>socket</code
										>方法建立了<code>websocket</code>和服务端的连接,并注册了2个监听事件
									</p>
									<p>
										<code>hash</code
										>事件,更新最后一次打包的hash值
									</p>
									<p><code>ok</code>事件,进行热更新检查</p>
									<p>
										热更新检查是调用<code>reloadApp</code>这个方法,比较奇怪的是,这个方法又利用<code>node.js</code>的<code>EvenEmitter</code>发出<code>webpackHotUpdate</code>消息
									</p>
									<p>入口文件的另一个文件</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token string">'xxx/node_modules/webpack/hot/dev-server.js'</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

									<p>
										这个同样会被打包到<code>bundle.js</code>中,运行在浏览器,代码如下
									</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token comment">// node_modules/webpack/hot/dev-server.js</span>
<span class="token keyword">var</span> <span class="token function-variable function">check</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">updatedModules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 容错，直接刷新页面</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>updatedModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token comment">// 热更新结束，打印信息</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">upToDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">,</span> <span class="token string">"[HMR] App is up to date."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> hotEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./emitter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hotEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"webpackHotUpdate"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">currentHash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lastHash <span class="token operator">=</span> currentHash<span class="token punctuation">;</span>
    <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<p>
										监听<code>webpackHotUpdate</code>事件,获取最新的hash值,进行检查更新,调用<code>module.hot.check</code>方法,这个方法是<code>HotModuleReplacementPlugin</code>产生的,后面会讲
									</p>
									<h5 id="HotModuleReplacementPlugin-1">
										<a
											href="#HotModuleReplacementPlugin-1"
											class="headerlink"
											title="HotModuleReplacementPlugin"
										></a
										>HotModuleReplacementPlugin
									</h5>
									<p>
										没有配置热更新的话,<code
											>bundle.js</code
										>
									</p>
									<p>
										<img
											src="/images/image_8.40d2b7ab.png"
										/>
									</p>
									<p>
										配置了<code>HotModuleReplacementPlugin</code>或者<code>--hot</code>的话
									</p>
									<p>
										<img
											src="/images/image_9.c398605f.png"
										/>
									</p>
									<p>
										就会发现配置的话,就多了一个属性<code>hot,再看</code>hotCreateModule方法,就你那个找到这个<code>module.hot.check</code>是从哪里冒出来的
									</p>
									<p>
										<img
											src="/images/image_10.e4fb9629.png"
										/>
									</p>
									<p>
										对比打包后的文件内容,可以发现<code>HotModuleReplacementPlugin</code>在文件中插入了很多的代码,这个主要是因为在检查更新的时候是在浏览器中的,插入代码方便在浏览器中运行
									</p>
									<h5 id="moudle-hot-check-开始热更新">
										<a
											href="#moudle-hot-check-开始热更新"
											class="headerlink"
											title="moudle.hot.check 开始热更新"
										></a
										>moudle.hot.check 开始热更新
									</h5>
									<p>
										后面的代码都是<code>HotModuleReplacentPlugin</code>塞入到<code>bundle.js</code>中的
									</p>
									<blockquote>
										<ul>
											<li>
												利用上次保存的<code>hash</code>值,调<code>hotDownLoadManifest\</code>发送
												<code
													>xxx/hash.hot-update.json</code
												>的<code>ajax</code>请求
											</li>
											<li>
												请求结果获取热更新模块,以及下次热更新的<code>hash</code>标识,并进入热更新准备阶段
											</li>
										</ul>
									</blockquote>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript">hotAvailableFilesMap <span class="token operator">=</span> update<span class="token punctuation">.</span>c<span class="token punctuation">;</span> <span class="token comment">// 需要更新的文件</span>
hotUpdateNewHash <span class="token operator">=</span> update<span class="token punctuation">.</span>h<span class="token punctuation">;</span> <span class="token comment">// 更新下次热更新hash值</span>
<span class="token function">hotSetStatus</span><span class="token punctuation">(</span><span class="token string">"prepare"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 进入热更新准备状态</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

									<p>
										调用<code>hotDownloadUpdateChunk</code>发送<code>xxx/hash.hot-update.js</code>请求,通过JSONP`方式
									</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">hotDownloadUpdateChunk</span><span class="token punctuation">(</span><span class="token parameter">chunkId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>charset <span class="token operator">=</span> <span class="token string">"utf-8"</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>src <span class="token operator">=</span> __webpack_require__<span class="token punctuation">.</span>p <span class="token operator">+</span> <span class="token string">""</span> <span class="token operator">+</span> chunkId <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> hotCurrentHash <span class="token operator">+</span> <span class="token string">".hot-update.js"</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> script<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<p>
										为什么要获通过JSONP,因为JSONP获取的代码可以直接执行.为什么要直接执行,首先会议一下<code>hash.hot-update.js</code>的代码格式是怎么样的
									</p>
									<p>
										<img
											src="/images/image_11.3598c6af.png"
										/>
									</p>
									<p>
										可以发现,新编译的代码是在一个<code>webpackHotUpdate</code>函数体内部的,也就是要立即执行这个方法
									</p>
									<p>
										再看一下这个<code>webpackHotUpdate</code>方法
									</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript">window<span class="token punctuation">[</span><span class="token string">"webpackHotUpdate"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunkId<span class="token punctuation">,</span> moreModules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">hotAddUpdateChunk</span><span class="token punctuation">(</span>chunkId<span class="token punctuation">,</span> moreModules<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

									<ul>
										<li>
											<code>hotAddUpdateChunk</code
											>方法会把更新的模块<code>moreModules</code>赋值给全局变量<code
												>hotupdate</code
											>
										</li>
										<li>
											<code>hotUpdateDownload</code
											>方法会调用<code>hotApply</code>进行代码的替换
										</li>
									</ul>
									<p>代码如下</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">hotAddUpdateChunk</span><span class="token punctuation">(</span><span class="token parameter">chunkId<span class="token punctuation">,</span> moreModules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 更新的模块moreModules赋值给全局全量hotUpdate</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> moduleId <span class="token keyword">in</span> moreModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>moreModules<span class="token punctuation">,</span> moduleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     hotUpdate<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> moreModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 调用hotApply进行模块的替换</span>
    <span class="token function">hotUpdateDownloaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<h5 id="hotApply-热更新模块替换">
										<a
											href="#hotApply-热更新模块替换"
											class="headerlink"
											title="hotApply 热更新模块替换"
										></a
										>hotApply 热更新模块替换
									</h5>
									<p>
										热更新的核心逻辑就在与<code
											>hotApply</code
										>
									</p>
									<p>主要可以分为以下几个部分</p>
									<h6 id="删除过期的模块-就是需要替换的模块">
										<a
											href="#删除过期的模块-就是需要替换的模块"
											class="headerlink"
											title="删除过期的模块,就是需要替换的模块"
										></a
										>删除过期的模块,就是需要替换的模块
									</h6>
									<p>
										通过<code>hotUpdate</code>可以找到旧模块
									</p>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token keyword">var</span> queue <span class="token operator">=</span> outdatedModules<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    moduleId <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 从缓存中删除过期的模块</span>
    module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 删除过期的依赖</span>
    <span class="token keyword">delete</span> outdatedDependencies<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 存储了被删掉的模块id，便于更新代码</span>
    outdatedSelfAcceptedModules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">module</span><span class="token operator">:</span> moduleId
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<h6 id="将新模块添加到modules中">
										<a
											href="#将新模块添加到modules中"
											class="headerlink"
											title="将新模块添加到modules中"
										></a
										>将新模块添加到<code>modules</code>中
									</h6>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript">appliedUpdate<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> hotUpdate<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>moduleId <span class="token keyword">in</span> appliedUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>appliedUpdate<span class="token punctuation">,</span> moduleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> appliedUpdate<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<h6
										id="通过-webpack-require-执行相关模块的代码"
									>
										<a
											href="#通过-webpack-require-执行相关模块的代码"
											class="headerlink"
											title="通过__webpack_require__执行相关模块的代码"
										></a
										>通过<code>__webpack_require__</code>执行相关模块的代码
									</h6>
									<pre
										class="line-numbers language-javascript"
										data-language="javascript"
									><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> outdatedSelfAcceptedModules<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> item <span class="token operator">=</span> outdatedSelfAcceptedModules<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    moduleId <span class="token operator">=</span> item<span class="token punctuation">.</span>module<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行最新的代码</span>
        <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...容错处理</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

									<p>
										<code>hotpply</code
										>很复杂,这只是一小部分流程
									</p>
									<h4 id="总结">
										<a
											href="#总结"
											class="headerlink"
											title="总结"
										></a
										>总结
									</h4>
									<p>热更新的流程图可以简化为一下几个部分</p>
									<p>
										<img
											src="/images/image_12.e9d272cb.png"
										/>
									</p>
									<h4 id="参考连接">
										<a
											href="#参考连接"
											class="headerlink"
											title="参考连接"
										></a
										>参考连接
									</h4>
									<p>
										本文是针对掘金<a
											target="_blank"
											rel="noopener"
											href="https://juejin.cn/post/6844904008432222215#heading-8"
											>轻松理解webpack热更新原理 - 掘金
											(juejin.cn)</a
										>,文章的笔记,大家看不懂我写的话,可以去看原篇,讲的特别好
									</p>
								</div>
								<hr />

								<div class="reprint" id="reprint-statement">
									<div class="reprint__author">
										<span
											class="reprint-meta"
											style="font-weight: bold"
										>
											<i class="fas fa-user">
												文章作者:
											</i>
										</span>
										<span class="reprint-info">
											<a
												href="/about"
												rel="external nofollow noreferrer"
												>Xiaolidu</a
											>
										</span>
									</div>
									<div class="reprint__type">
										<span
											class="reprint-meta"
											style="font-weight: bold"
										>
											<i class="fas fa-link">
												文章链接:
											</i>
										</span>
										<span class="reprint-info">
											<a
												href="https://xiaolidu11.gitee.io/2022/09/07/webpack-re-mo-kuai-geng-xin-yuan-li/"
												>https://xiaolidu11.gitee.io/2022/09/07/webpack-re-mo-kuai-geng-xin-yuan-li/</a
											>
										</span>
									</div>
									<div class="reprint__notice">
										<span
											class="reprint-meta"
											style="font-weight: bold"
										>
											<i class="fas fa-copyright">
												版权声明:
											</i>
										</span>
										<span class="reprint-info">
											本博客所有文章除特別声明外，均采用
											<a
												href="https://creativecommons.org/licenses/by/4.0/deed.zh"
												rel="external nofollow noreferrer"
												target="_blank"
												>CC BY 4.0</a
											>
											许可协议。转载请注明来源
											<a href="/about" target="_blank"
												>Xiaolidu</a
											>
											!
										</span>
									</div>
								</div>

								<script async defer>
									document.addEventListener(
										'copy',
										function (e) {
											let toastHTML =
												'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
											M.toast({ html: toastHTML });
										}
									);

									function navToReprintStatement() {
										$('html, body').animate(
											{
												scrollTop:
													$(
														'#reprint-statement'
													).offset().top - 80,
											},
											800
										);
									}
								</script>

								<div class="tag_share" style="display: block">
									<div
										class="post-meta__tag-list"
										style="display: inline-block"
									>
										<div class="article-tag">
											<a href="/tags/%E9%9D%A2%E8%AF%95/">
												<span class="chip bg-color"
													>面试</span
												>
											</a>
										</div>
									</div>
									<div
										class="post_share"
										style="
											zoom: 80%;
											width: fit-content;
											display: inline-block;
											float: right;
											margin: -0.15rem 0;
										"
									>
										<link
											rel="stylesheet"
											type="text/css"
											href="/skills-github-pages/libs/share/css/share.min.css"
										/>
										<div id="article-share">
											<div
												class="social-share"
												data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin"
												data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"
											></div>
											<script src="/skills-github-pages/libs/share/js/social-share.min.js"></script>
										</div>
									</div>
								</div>

								<div id="reward">
									<a
										href="#rewardModal"
										class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red"
										>赏</a
									>

									<!-- Modal Structure -->
									<div id="rewardModal" class="modal">
										<div class="modal-content">
											<a class="close modal-close"
												><i class="fas fa-times"></i
											></a>
											<h4 class="reward-title">
												你的赏识是我前进的动力
											</h4>
											<div class="reward-content">
												<div class="reward-tabs">
													<ul class="tabs row">
														<li
															class="tab col s6 alipay-tab waves-effect waves-light"
														>
															<a href="#alipay"
																>支付宝</a
															>
														</li>
														<li
															class="tab col s6 wechat-tab waves-effect waves-light"
														>
															<a href="#wechat"
																>微 信</a
															>
														</li>
													</ul>
													<div id="alipay">
														<img
															src="/medias/reward/alipay.jpg"
															class="reward-img"
															alt="支付宝打赏二维码"
														/>
													</div>
													<div id="wechat">
														<img
															src="/medias/reward/wechat.png"
															class="reward-img"
															alt="微信打赏二维码"
														/>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>

								<script>
									$(function () {
										$('.tabs').tabs();
									});
								</script>
							</div>
						</div>

						<article id="prenext-posts" class="prev-next articles">
							<div class="row article-row">
								<div
									class="article col s12 m6"
									data-aos="fade-up"
								>
									<div
										class="article-badge left-badge text-color"
									>
										<i class="fas fa-chevron-left"></i
										>&nbsp;上一篇
									</div>
									<div class="card">
										<a
											href="/2022/09/15/chang-jian-shou-xie-ti-hui-zong-1/"
										>
											<div class="card-image">
												<img
													src="/medias/featureimages/4.jpg"
													class="responsive-img"
													alt="常见手写题汇总1"
												/>

												<span class="card-title"
													>常见手写题汇总1</span
												>
											</div>
										</a>
										<div
											class="card-content article-content"
										>
											<div
												class="summary block-with-text"
											>
												常见手写题汇总1
											</div>
											<div class="publish-info">
												<span class="publish-date">
													<i
														class="far fa-clock fa-fw icon-date"
													></i
													>2022-09-15
												</span>
												<span class="publish-author">
													<i
														class="fas fa-bookmark fa-fw icon-category"
													></i>

													<a
														href="/categories/%E6%89%8B%E5%86%99%E9%A2%98/"
														class="post-category"
													>
														手写题
													</a>
												</span>
											</div>
										</div>

										<div class="card-action article-tags">
											<a
												href="/tags/%E6%89%8B%E5%86%99%E9%A2%98%E6%B1%87%E6%80%BB/"
											>
												<span class="chip bg-color"
													>手写题汇总</span
												>
											</a>
										</div>
									</div>
								</div>

								<div
									class="article col s12 m6"
									data-aos="fade-up"
								>
									<div
										class="article-badge right-badge text-color"
									>
										下一篇&nbsp;<i
											class="fas fa-chevron-right"
										></i>
									</div>
									<div class="card">
										<a
											href="/2022/08/20/he-xin-gong-gong-zu-jian-bian-xie-gong-gong-han-shu-feng-zhuang-bu-duan-you-hua-ye-wu-dai-ma-shi-xian-di-ou-he-gao-ju-he-de-si-xiang/"
										>
											<div class="card-image">
												<img
													src="/medias/featureimages/9.jpg"
													class="responsive-img"
													alt="公共组件的封装"
												/>

												<span class="card-title"
													>公共组件的封装</span
												>
											</div>
										</a>
										<div
											class="card-content article-content"
										>
											<div
												class="summary block-with-text"
											>
												公共组件的封装
											</div>
											<div class="publish-info">
												<span class="publish-date">
													<i
														class="far fa-clock fa-fw icon-date"
													></i
													>2022-08-20
												</span>
												<span class="publish-author">
													<i
														class="fas fa-bookmark fa-fw icon-category"
													></i>

													<a
														href="/categories/%E9%A1%B9%E7%9B%AE/"
														class="post-category"
													>
														项目
													</a>
												</span>
											</div>
										</div>

										<div class="card-action article-tags">
											<a href="/tags/%E7%AE%80%E5%8E%86/">
												<span class="chip bg-color"
													>简历</span
												>
											</a>
										</div>
									</div>
								</div>
							</div>
						</article>
					</div>

					<!-- 代码块功能依赖 -->
					<script
						type="text/javascript"
						src="/skills-github-pages/libs/codeBlock/codeBlockFuction.js"
					></script>

					<!-- 是否加载使用自带的 prismjs. -->
					<script
						type="text/javascript"
						src="/skills-github-pages/libs/prism/prism.min.js"
					></script>

					<!-- 代码语言 -->

					<script
						type="text/javascript"
						src="/skills-github-pages/libs/codeBlock/codeLang.js"
					></script>

					<!-- 代码块复制 -->

					<script
						type="text/javascript"
						src="/skills-github-pages/libs/codeBlock/codeCopy.js"
					></script>

					<!-- 代码块收缩 -->

					<script
						type="text/javascript"
						src="/skills-github-pages/libs/codeBlock/codeShrink.js"
					></script>
				</div>
				<div
					id="toc-aside"
					class="expanded col l3 hide-on-med-and-down"
				>
					<div
						class="toc-widget card"
						style="background-color: white"
					>
						<div class="toc-title">
							<i class="far fa-list-alt"></i>&nbsp;&nbsp;目录
						</div>
						<div id="toc-content"></div>
					</div>
				</div>
			</div>

			<!-- TOC 悬浮按钮. -->

			<div id="floating-toc-btn" class="hide-on-med-and-down">
				<a class="btn-floating btn-large bg-color">
					<i class="fas fa-list-ul"></i>
				</a>
			</div>

			<script src="/skills-github-pages/libs/tocbot/tocbot.min.js"></script>
			<script>
				$(function () {
					tocbot.init({
						tocSelector: '#toc-content',
						contentSelector: '#articleContent',
						headingsOffset: -($(window).height() * 0.4 - 45),
						collapseDepth: Number('0'),
						headingSelector: 'h2, h3, h4',
					});

					// Set scroll toc fixed.
					let tocHeight = parseInt($(window).height() * 0.4 - 64);
					let $tocWidget = $('.toc-widget');
					$(window).scroll(function () {
						let scroll = $(window).scrollTop();
						/* add post toc fixed. */
						if (scroll > tocHeight) {
							$tocWidget.addClass('toc-fixed');
						} else {
							$tocWidget.removeClass('toc-fixed');
						}
					});

					/* 修复文章卡片 div 的宽度. */
					let fixPostCardWidth = function (srcId, targetId) {
						let srcDiv = $('#' + srcId);
						if (srcDiv.length === 0) {
							return;
						}

						let w = srcDiv.width();
						if (w >= 450) {
							w = w + 21;
						} else if (w >= 350 && w < 450) {
							w = w + 18;
						} else if (w >= 300 && w < 350) {
							w = w + 16;
						} else {
							w = w + 14;
						}
						$('#' + targetId).width(w);
					};

					// 切换TOC目录展开收缩的相关操作.
					const expandedClass = 'expanded';
					let $tocAside = $('#toc-aside');
					let $mainContent = $('#main-content');
					$('#floating-toc-btn .btn-floating').click(function () {
						if ($tocAside.hasClass(expandedClass)) {
							$tocAside.removeClass(expandedClass).hide();
							$mainContent.removeClass('l9');
						} else {
							$tocAside.addClass(expandedClass).show();
							$mainContent.addClass('l9');
						}
						fixPostCardWidth('artDetail', 'prenext-posts');
					});
				});
			</script>
		</main>

		<footer class="page-footer bg-color">
			<div
				class="container row center-align"
				style="margin-bottom: 0px !important"
			>
				<div class="col s12 m8 l8 copy-right">
					Copyright&nbsp;&copy;

					<span id="year"> 2019-2023 </span>

					<a href="/about" target="_blank"> Xiaolidu11 </a>
					|&nbsp;Powered by&nbsp;<a
						href="https://hexo.io/"
						target="_blank"
						>Hexo</a
					>
					|&nbsp;Theme&nbsp;<a
						href="https://github.com/blinkfox/hexo-theme-matery"
						target="_blank"
						>Matery</a
					>
					<br />
					<!-- 站点总字数 -->

					&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数
					:&nbsp;<span class="white-color"> 117.3k </span>

					<!-- 总访问量 -->

					<!-- 总访问人数 -->

					<span id="busuanzi_container_site_pv">
						&nbsp;|&nbsp;<i class="far fa-eye"></i
						>&nbsp;总访问量:&nbsp;
						<span
							id="busuanzi_value_site_pv"
							class="white-color"
						></span>
					</span>

					<span id="busuanzi_container_site_uv">
						&nbsp;|&nbsp;<i class="fas fa-users"></i
						>&nbsp;总访问人数:&nbsp;
						<span
							id="busuanzi_value_site_uv"
							class="white-color"
						></span>
					</span>

					<br />

					<!-- 运行天数提醒. -->

					<br />
				</div>
				<div class="col s12 m4 l4 social-link">
					<a
						href="https://github.com/xiaolidu111"
						class="tooltipped"
						target="_blank"
						data-tooltip="访问我的GitHub"
						data-position="top"
						data-delay="50"
					>
						<i class="fab fa-github"></i>
					</a>

					<a
						href="mailto:xiaolidu11@163.com"
						class="tooltipped"
						target="_blank"
						data-tooltip="邮件联系我"
						data-position="top"
						data-delay="50"
					>
						<i class="fas fa-envelope-open"></i>
					</a>

					<a
						href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1724689773"
						class="tooltipped"
						target="_blank"
						data-tooltip="QQ联系我: 1724689773"
						data-position="top"
						data-delay="50"
					>
						<i class="fab fa-qq"></i>
					</a>

					<a
						href="xiaolidu111"
						class="tooltipped"
						target="_blank"
						data-tooltip="关注我的微信: xiaolidu111"
						data-position="top"
						data-delay="50"
					>
						<i class="fab fa-weixin"></i>
					</a>
				</div>
			</div>
		</footer>

		<div class="progress-bar"></div>

		<!-- 搜索遮罩框 -->
		<div id="searchModal" class="modal">
			<div class="modal-content">
				<div class="search-header">
					<span class="title"
						><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span
					>
					<input
						type="search"
						id="searchInput"
						name="s"
						placeholder="请输入搜索的关键字"
						class="search-input"
					/>
				</div>
				<div id="searchResult"></div>
			</div>
		</div>

		<script type="text/javascript">
			$(function () {
				var searchFunc = function (path, search_id, content_id) {
					'use strict';
					$.ajax({
						url: path,
						dataType: 'xml',
						success: function (xmlResponse) {
							// get the contents from search data
							var datas = $('entry', xmlResponse)
								.map(function () {
									return {
										title: $('title', this).text(),
										content: $('content', this).text(),
										url: $('url', this).text(),
									};
								})
								.get();
							var $input = document.getElementById(search_id);
							var $resultContent =
								document.getElementById(content_id);
							$input.addEventListener('input', function () {
								var str = '<ul class="search-result-list">';
								var keywords = this.value
									.trim()
									.toLowerCase()
									.split(/[\s\-]+/);
								$resultContent.innerHTML = '';
								if (this.value.trim().length <= 0) {
									return;
								}
								// perform local searching
								datas.forEach(function (data) {
									var isMatch = true;
									var data_title = data.title
										.trim()
										.toLowerCase();
									var data_content = data.content
										.trim()
										.replace(/<[^>]+>/g, '')
										.toLowerCase();
									var data_url = data.url;
									data_url =
										data_url.indexOf('/') === 0
											? data.url
											: '/' + data_url;
									var index_title = -1;
									var index_content = -1;
									var first_occur = -1;
									// only match artiles with not empty titles and contents
									if (
										data_title !== '' &&
										data_content !== ''
									) {
										keywords.forEach(function (keyword, i) {
											index_title =
												data_title.indexOf(keyword);
											index_content =
												data_content.indexOf(keyword);
											if (
												index_title < 0 &&
												index_content < 0
											) {
												isMatch = false;
											} else {
												if (index_content < 0) {
													index_content = 0;
												}
												if (i === 0) {
													first_occur = index_content;
												}
											}
										});
									}
									// show search results
									if (isMatch) {
										str +=
											"<li><a href='" +
											data_url +
											"' class='search-result-title'>" +
											data_title +
											'</a>';
										var content = data.content
											.trim()
											.replace(/<[^>]+>/g, '');
										if (first_occur >= 0) {
											// cut out 100 characters
											var start = first_occur - 20;
											var end = first_occur + 80;
											if (start < 0) {
												start = 0;
											}
											if (start === 0) {
												end = 100;
											}
											if (end > content.length) {
												end = content.length;
											}
											var match_content = content.substr(
												start,
												end
											);
											// highlight all keywords
											keywords.forEach(function (
												keyword
											) {
												var regS = new RegExp(
													keyword,
													'gi'
												);
												match_content =
													match_content.replace(
														regS,
														'<em class="search-keyword">' +
															keyword +
															'</em>'
													);
											});

											str +=
												'<p class="search-result">' +
												match_content +
												'...</p>';
										}
										str += '</li>';
									}
								});
								str += '</ul>';
								$resultContent.innerHTML = str;
							});
						},
					});
				};

				searchFunc('/search.xml', 'searchInput', 'searchResult');
			});
		</script>

		<!-- 白天和黑夜主题 -->
		<div class="stars-con">
			<div id="stars"></div>
			<div id="stars2"></div>
			<div id="stars3"></div>
		</div>

		<script>
			function switchNightMode() {
				$(
					'<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>'
				).appendTo($('body')),
					setTimeout(function () {
						$('body').hasClass('DarkMode')
							? ($('body').removeClass('DarkMode'),
							  localStorage.setItem('isDark', '0'),
							  $('#sum-moon-icon')
									.removeClass('fa-sun')
									.addClass('fa-moon'))
							: ($('body').addClass('DarkMode'),
							  localStorage.setItem('isDark', '1'),
							  $('#sum-moon-icon')
									.addClass('fa-sun')
									.removeClass('fa-moon')),
							setTimeout(function () {
								$('.Cuteen_DarkSky').fadeOut(1e3, function () {
									$(this).remove();
								});
							}, 2e3);
					});
			}
		</script>

		<!-- 回到顶部按钮 -->
		<div id="backTop" class="top-scroll">
			<a
				class="btn-floating btn-large waves-effect waves-light"
				href="#!"
			>
				<i class="fas fa-arrow-up"></i>
			</a>
		</div>

		<script src="/skills-github-pages/libs/materialize/materialize.min.js"></script>
		<script src="/skills-github-pages/libs/masonry/masonry.pkgd.min.js"></script>
		<script src="/skills-github-pages/libs/aos/aos.js"></script>
		<script src="/skills-github-pages/libs/scrollprogress/scrollProgress.min.js"></script>
		<script src="/skills-github-pages/libs/lightGallery/js/lightgallery-all.min.js"></script>
		<script src="/js/matery.js"></script>

		<!-- 雪花特效 -->

		<!-- 鼠标星星特效 -->

		<script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
		<script src="/skills-github-pages/libs/others/TencentCaptcha.js"></script>
		<button
			id="TencentCaptcha"
			data-appid="xxxxxxxxxx"
			data-cbfn="callback"
			type="button"
			hidden
		></button>

		<!-- Baidu Analytics -->

		<!-- Baidu Push -->

		<script>
			(function () {
				var bp = document.createElement('script');
				var curProtocol = window.location.protocol.split(':')[0];
				if (curProtocol === 'https') {
					bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
				} else {
					bp.src = 'http://push.zhanzhang.baidu.com/push.js';
				}
				var s = document.getElementsByTagName('script')[0];
				s.parentNode.insertBefore(bp, s);
			})();
		</script>

		<!--腾讯兔小巢-->

		<script
			src="/skills-github-pages/libs/instantpage/instantpage.js"
			type="module"
		></script>
	</body>
</html>
